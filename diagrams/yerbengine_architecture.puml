@startuml
left to right direction
skinparam classAttributeIconSize 0
skinparam componentStyle rectangle
title YerbEngine - Detailed Class Diagram

' Core
package "Core" {
  class GameEngine {
    - m_fontManager: std::unique_ptr<FontManager>
    - m_textureManager: std::unique_ptr<TextureManager>
    - m_audioManager: std::unique_ptr<AudioManager>
    - m_audioSampleQueue: std::unique_ptr<AudioSampleQueue>
    - m_videoManager: std::unique_ptr<VideoManager>
    - m_config: ConfigAdapter*
    - m_currentScene: shared_ptr<Scene>
    - m_running: bool
    + GameEngine(configPath: string)
    + LoadScene(name: string, scene: shared_ptr<Scene>) : void
    + GetConfig() : ConfigAdapter&
    + Run() : void
    + UpdateLoop(delta: float) : void
  }

  abstract class Scene {
    - m_gameEngine: GameEngine*
    + Scene(engine: GameEngine*)
    + virtual update(delta: float) : void
    + virtual sRender() : void
    + virtual sDoAction(action: Action&) : void
    + virtual sAudio() : void
    + virtual onEnd() : void
    + virtual onSceneWindowResize(w: int, h: int) : void
  }
}

package "Managers" {
  package "Asset Managers" {
    class FontManager {
      - m_fonts: map<string, Font>
      + loadFont(path: string, size: int) : FontID
      + getFont(id: FontID) : Font
    }

    class TextureManager {
      - m_textures: map<string, Texture>
      + loadTexture(path: string) : TextureID
      + getTexture(id: TextureID) : Texture
    }

    class AudioSampleQueue {
      - queue: deque<AudioSample>
      + queueSample(sampleId: AudioSampleID, volume: float) : void
      + update() : void
    }
  }

  package "System Managers" {
    class AudioManager {
      - m_tracks: map<AudioTrack, Track>
      + playTrack(track: AudioTrack, loops: int) : void
      + muteTracks() : void
      + getCurrentAudioTrack() : AudioTrack
    }

    class VideoManager {
      - renderer: SDL_Renderer*
      + getRenderer() : SDL_Renderer*
      + getWindowSize() : Vec2
    }
  }
}

' Configuration subsystem
package "Configuration" {
  class ConfigStore {
    - m_values: map<string, string>
    + get(key: string) : string
    + set(key: string, value: string) : void
  }

  class JsonConfigProvider {
    + loadFromFile(path: string) : ConfigStore
  }

  class ConfigAdapter {
    - store: ConfigStore*
    + getInt(key: string, def: int) : int
    + getFloat(key: string, def: float) : float
    + getString(key: string, def: string) : string
  }
}

' Entity-Component System
package "ECS" {
  class EntityManager {
    - m_entities: vector<shared_ptr<Entity>>
    - m_toAdd: vector<shared_ptr<Entity>>
    - m_entityMap: unordered_map<EntityTags, vector<shared_ptr<Entity>>>
    - m_totalEntities: size_t
    + addEntity(tag: EntityTags) : shared_ptr<Entity>
    + getEntities() : vector<shared_ptr<Entity>>&
    + getEntities(tag: EntityTags) : vector<shared_ptr<Entity>>&
    + update() : void
  }

  class Entity {
    - m_active: bool
    - m_id: size_t
    - m_tag: EntityTags
    - m_components: tuple<shared_ptr<CTransform>, shared_ptr<CShape>, shared_ptr<CInput>, shared_ptr<CLifespan>, shared_ptr<CEffects>, shared_ptr<CBounceTracker>, shared_ptr<CSprite>>
    + isActive() : bool
    + tag() : EntityTags
    + id() : size_t
    + destroy() : void
    + getCenterPos() : Vec2
    + getComponent<T>() : shared_ptr<T>
    + setComponent<T>(shared_ptr<T>) : void
    + removeComponent<T>() : void
    + hasComponent<T>() : bool
  }

  class CTransform {
    - topLeftCornerPos: Vec2
    - velocity: Vec2
    + CTransform(position: Vec2, velocity: Vec2)
  }

  class CShape {
    - renderer: SDL_Renderer*
    - rect: SDL_Rect
    - color: SDL_Color
    + CShape(renderer: SDL_Renderer*, height: float, width: float, color: SDL_Color)
  }

  class CInput {
    - forward: bool
    - backward: bool
    - left: bool
    - right: bool
    + CInput()
  }

  class CLifespan {
    - birthTime: Uint64
    - lifespan: Uint64
    + CLifespan()
    + CLifespan(lifespan: Uint64)
  }

  class CEffects {
    - effects: vector<Effect>
    + addEffect(effect: Effect) : void
    + getEffects() : vector<Effect> const&
    + removeEffect(type: EffectTypes) : void
    + hasEffect(type: EffectTypes) : bool
    + clearEffects() : void
  }

  class CBounceTracker {
    - m_bounces: int
    + addBounce() : void
    + getBounces() : int
  }

  class CSprite {
    - m_texture: SDL_Texture*
    + CSprite(texture: SDL_Texture*)
    + getTexture() : SDL_Texture*
  }
}

' Relationships
GameEngine --> FontManager : owns
GameEngine --> TextureManager : owns
GameEngine --> AudioManager : owns
GameEngine --> AudioSampleQueue : owns
GameEngine --> VideoManager : owns
GameEngine --> ConfigAdapter : uses
GameEngine --> Scene : manages

Scene --> EntityManager : uses
Scene --> TextureManager : uses
Scene --> AudioManager : uses

ConfigAdapter --> ConfigStore : backs
JsonConfigProvider --> ConfigStore : loads

EntityManager --> Entity : creates/manages
Entity *-- CTransform : contains
Entity *-- CShape : contains
Entity *-- CInput : contains
Entity *-- CLifespan : contains
Entity *-- CEffects : contains
Entity *-- CBounceTracker : contains
Entity *-- CSprite : contains


note left of GameEngine
  Initializes managers and hosts the main loop
  Provides access to configuration and scene lifecycle
end note

note right of EntityManager
  Tag-based lookups and shared_ptr component storage
end note

@enduml
