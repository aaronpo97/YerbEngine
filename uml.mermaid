---
title: YerbEngine Architecture
---

classDiagram
    %% ===========================
    %% Core Engine Classes
    %% ===========================
    
    class GameEngine {
        -map~string, shared_ptr~Scene~~ m_scenes
        -string m_currentSceneName
        -bool m_isRunning
        -unique_ptr~ConfigManager~ m_configManager
        -unique_ptr~FontManager~ m_fontManager
        -unique_ptr~AudioManager~ m_audioManager
        -unique_ptr~TextureManager~ m_texture_manager
        -unique_ptr~AudioSampleQueue~ m_audioSampleQueue
        -unique_ptr~VideoManager~ m_videoManager
        +void run()
        +void quit()
        +bool isRunning()
        +void loadScene(string name, shared_ptr~Scene~ scene)
        +ConfigManager& getConfigManager()
        +FontManager& getFontManager()
        +AudioManager& getAudioManager()
        +AudioSampleQueue& getAudioSampleQueue()
        +TextureManager& getTextureManager()
        +VideoManager& getVideoManager()
        -void update()
        -void sUserInput()
        -static void mainLoop(void* arg)
        -static void cleanup()
        -unique_ptr~ConfigManager~ createConfigManager(Path)
        -unique_ptr~TextureManager~ createTextureManager()
        -unique_ptr~VideoManager~ createVideoManager()
        -unique_ptr~AudioManager~ createAudioManager()
        -unique_ptr~FontManager~ createFontManager()
        -unique_ptr~AudioSampleQueue~ initializeAudioSampleQueue()
    }

    class Scene {
        <<abstract>>
        #GameEngine* m_gameEngine
        #Uint64 m_lastFrameTime
        #float m_deltaTime
        #bool m_endTriggered
        #bool m_hasEnded
        #bool m_paused
        #Uint64 m_SceneStartTime
        #ActionMap m_actionMap
        +void registerAction(int inputKey, string actionName)
        +void setPaused(bool paused)
        +void setStartTime(Uint64 startTime)
        +ActionMap getActionMap()
        +Uint64 getStartTime()
        +update()* void
        +onEnd()* void
        +sRender()* void
        +sDoAction(Action& action)* void
        +sAudio()* void
        +onSceneWindowResize()* void
    }

    class MainScene {
        -EntityManager m_entities
        -shared_ptr~Entity~ m_player
        -MainSceneSpawner m_spawner
        -int m_score
        -int m_lives
        -Uint64 m_timeRemaining
        -Uint64 m_lastNonPlayerEntitySpawnTime
        -Uint64 m_lastBulletSpawnTime
        -Uint64 m_bulletSpawnCooldown
        -bool m_gameOver
        -random_device m_rd
        -mt19937 m_randomGenerator
        +void update()
        +void onEnd()
        +void sRender()
        +void sDoAction(Action& action)
        +void sAudio()
        +void onSceneWindowResize()
        +void sCollision()
        +void sMovement()
        +void sSpawner()
        +void sLifespan()
        +void sEffects()
        +void sTimer()
        +int getScore()
        +void setScore(int score)
        +void decrementLives()
        +void setGameOver()
        -void renderText()
    }

    class MenuScene {
        -bool m_playButtonClicked
        -bool m_instructionsButtonClicked
        -unsigned int m_selectedIndex
        +void update()
        +void onEnd()
        +void sRender()
        +void sDoAction(Action& action)
        +void sAudio()
        +void onSceneWindowResize()
        -void renderText()
    }

    class ScoreScene {
        -unsigned int m_score
        -unsigned int m_selectedIndex
        +void update()
        +void onEnd()
        +void sRender()
        +void sDoAction(Action& action)
        +void sAudio()
        +void onSceneWindowResize()
        -void renderText()
    }

    class HowToPlayScene {
        +void update()
        +void onEnd()
        +void sRender()
        +void sDoAction(Action& action)
        +void sAudio()
        +void onSceneWindowResize()
        -void renderText()
    }

    class MainSceneSpawner {
        -mt19937& m_randomGenerator
        -ConfigManager& m_configManager
        -TextureManager& m_textureManager
        -EntityManager& m_entityManager
        -SDL_Renderer* m_renderer
        +shared_ptr~Entity~ spawnPlayer()
        +void spawnEnemy(shared_ptr~Entity~ player)
        +void spawnSpeedBoostEntity(shared_ptr~Entity~ player)
        +void spawnSlownessEntity(shared_ptr~Entity~ player)
        +void spawnWalls()
        +void spawnBullets(shared_ptr~Entity~ player, Vec2 mousePosition)
        +void spawnItem(shared_ptr~Entity~ player)
    }

    class Action {
        -string m_name
        -ActionState m_state
        -optional~Vec2~ m_pos
        +string getName()
        +ActionState getState()
        +optional~Vec2~ getPos()
    }

    class ActionState {
        <<enumeration>>
        START
        END
    }

    %% ===========================
    %% Entity Component System
    %% ===========================

    class Entity {
        -bool m_active
        -size_t m_id
        -EntityTags m_tag
        -EntityComponents m_components
        +bool isActive()
        +EntityTags tag()
        +size_t id()
        +void destroy()
        +Vec2 getCenterPos()
        +shared_ptr~T~ getComponent~T~()
        +void setComponent~T~(shared_ptr~T~)
        +void removeComponent~T~()
        +bool hasComponent~T~()
    }

    class EntityManager {
        -EntityList m_entities
        -EntityList m_toAdd
        -EntityMap m_entityMap
        -size_t m_totalEntities
        +shared_ptr~Entity~ addEntity(EntityTags tag)
        +EntityList& getEntities()
        +EntityList& getEntities(EntityTags tag)
        +void update()
    }

    class EntityTags {
        <<enumeration>>
        Player
        Wall
        SpeedBoost
        SlownessDebuff
        Enemy
        Bullet
        Item
        Default
    }

    class EffectTypes {
        <<enumeration>>
        Speed
        Slowness
    }

    %% ===========================
    %% Component Classes
    %% ===========================

    class CTransform {
        +Vec2 topLeftCornerPos
        +Vec2 velocity
    }

    class CShape {
        -SDL_Renderer* renderer
        +SDL_Rect rect
        +SDL_Color color
    }

    class CInput {
        +bool forward
        +bool backward
        +bool left
        +bool right
    }

    class CLifespan {
        +Uint64 birthTime
        +Uint64 lifespan
    }

    class Effect {
        <<struct>>
        +Uint64 startTime
        +Uint64 duration
        +EffectTypes type
    }

    class CEffects {
        -vector~Effect~ effects
        +void addEffect(Effect effect)
        +vector~Effect~ getEffects()
        +void removeEffect(EffectTypes type)
        +bool hasEffect(EffectTypes type)
        +void clearEffects()
    }

    class CBounceTracker {
        -int m_bounces
        +void addBounce()
        +int getBounces()
    }

    class CSprite {
        -SDL_Texture* m_texture
        +SDL_Texture* getTexture()
    }

    %% ===========================
    %% Manager Classes
    %% ===========================

    class ConfigManager {
        -GameConfig m_gameConfig
        -PlayerConfig m_playerConfig
        -EnemyConfig m_enemyConfig
        -BulletConfig m_bulletConfig
        -ItemConfig m_itemConfig
        -SpeedEffectConfig m_speedEffectConfig
        -SlownessEffectConfig m_slownessEffectConfig
        -json m_json
        -filesystem::path m_configPath
        +GameConfig getGameConfig()
        +PlayerConfig getPlayerConfig()
        +EnemyConfig getEnemyConfig()
        +BulletConfig getBulletConfig()
        +ItemConfig getItemConfig()
        +SpeedEffectConfig getSpeedEffectConfig()
        +SlownessEffectConfig getSlownessEffectConfig()
        +void updatePlayerShape(ShapeConfig)
        +void updatePlayerSpeed(float)
        +void updateGameWindowSize(Vec2)
        -void parseConfig()
        -void loadConfig()
    }

    class VideoManager {
        -SDL_Renderer* m_renderer
        -SDL_Window* m_window
        -Vec2 m_currentWindowSize
        -ConfigManager& m_configManager
        +SDL_Renderer* getRenderer()
        +SDL_Window* getWindow()
        +Vec2 getWindowSize()
        +void updateWindowSize()
        +void clearScreen()
        +void display()
        -void initializeVideoSystem()
        -void setupRenderer()
        -SDL_Renderer* createRenderer()
        -SDL_Window* createWindow()
    }

    class AudioManager {
        -unordered_map~AudioTrack, Mix_Music*~ m_audioTracks
        -unordered_map~AudioSample, Mix_Chunk*~ m_audioSamples
        -AudioTrack m_currentAudioTrack
        -AudioTrack m_lastAudioTrack
        +void playTrack(AudioTrack track)
        +void playSample(AudioSample sample)
        +void stopTrack()
        +void pauseTrack()
        +void resumeTrack()
        +void setTrackVolume(int volume)
        +void setSampleVolume(int volume)
        -void loadAudioTracks()
        -void loadAudioSamples()
    }

    class AudioTrack {
        <<enumeration>>
        NONE
        MAIN_MENU
        PLAY
    }

    class AudioSample {
        <<enumeration>>
        NONE
        ITEM_ACQUIRED
        ENEMY_COLLISION
        SPEED_BOOST
        SLOWNESS_DEBUFF
        MENU_MOVE
        MENU_SELECT
        SHOOT
        BULLET_HIT_01
        BULLET_HIT_02
    }

    class FontManager {
        -filesystem::path m_fontPath
        -int m_fontSizeSm
        -int m_fontSizeMd
        -int m_fontSizeLg
        -TTF_Font* m_fontLg
        -TTF_Font* m_fontMd
        -TTF_Font* m_fontSm
        +TTF_Font* getFontLg()
        +TTF_Font* getFontMd()
        +TTF_Font* getFontSm()
        +void loadFonts(Path fontPath)
    }

    class TextureManager {
        -unordered_map~TextureName, SDL_Surface*~ m_surfaces
        -unordered_map~TextureName, SDL_Texture*~ m_textures
        -SDL_Renderer* m_renderer
        +SDL_Texture* getTexture(TextureName name)
        -void loadTexture(TextureName name)
    }

    class AudioSampleQueue {
        -queue~AudioSample~ m_queue
        +void enqueue(AudioSample sample)
        +optional~AudioSample~ dequeue()
        +bool isEmpty()
        +void clear()
    }

    %% ===========================
    %% Helper Namespaces
    %% ===========================

    class CollisionHelpers {
        <<namespace>>
        +bitset~4~ detectOutOfBounds(shared_ptr~Entity~, Vec2 windowSize)
        +bool calculateCollisionBetweenEntities(shared_ptr~Entity~, shared_ptr~Entity~)
        +Vec2 calculateOverlap(shared_ptr~Entity~, shared_ptr~Entity~)
        +bitset~4~ getPositionRelativeToEntity(shared_ptr~Entity~, shared_ptr~Entity~)
    }

    class SpawnHelpers {
        <<namespace>>
        +shared_ptr~Entity~ spawnEntity(EntityManager&, EntityTags)
        +void spawnEnemyAtRandomPosition(EntityManager&)
        +void spawnBullet(EntityManager&, Vec2 position, Vec2 velocity)
    }

    class EntityHelpers {
        <<namespace>>
        +void destroyEntity(Entity)
        +Vec2 getEntityCenter(Entity)
        +void setEntityPosition(Entity, Vec2)
    }

    class TextHelpers {
        <<namespace>>
        +void renderText(SDL_Renderer*, TTF_Font*, string, Vec2, SDL_Color)
        +SDL_Texture* createTextTexture(SDL_Renderer*, TTF_Font*, string, SDL_Color)
    }

    class MathHelpers {
        <<namespace>>
        +float pi
        +float degreesToRadians(float degrees)
        +float radiansToDegrees(float radians)
        +float pythagorasSquared(float a, float b)
        +float pythagoras(float a, float b)
    }

    %% ===========================
    %% Utility Classes
    %% ===========================

    class Vec2 {
        +float x
        +float y
        +Vec2 operator+(Vec2)
        +Vec2 operator-(Vec2)
        +Vec2 operator*(float)
        +Vec2 operator/(float)
        +float length()
        +Vec2 normalize()
    }

    %% ===========================
    %% Configuration Structs
    %% ===========================

    class GameConfig {
        <<struct>>
        +Vec2 windowSize
        +string windowTitle
        +filesystem::path fontPath
        +Uint64 spawnInterval
        +int fontSizeSm
        +int fontSizeMd
        +int fontSizeLg
    }

    class PlayerConfig {
        <<struct>>
        +float baseSpeed
        +float speedBoostMultiplier
        +float slownessMultiplier
        +ShapeConfig shape
    }

    class EnemyConfig {
        <<struct>>
        +Uint8 spawnPercentage
        +Uint64 lifespan
        +float speed
        +ShapeConfig shape
    }

    class BulletConfig {
        <<struct>>
        +Uint64 lifespan
        +float speed
        +ShapeConfig shape
    }

    class ItemConfig {
        <<struct>>
        +Uint8 spawnPercentage
        +Uint64 lifespan
        +float speed
        +ShapeConfig shape
    }

    class SpeedEffectConfig {
        <<struct>>
        +Uint8 spawnPercentage
        +Uint64 lifespan
        +float speed
        +ShapeConfig shape
    }

    class SlownessEffectConfig {
        <<struct>>
        +Uint8 spawnPercentage
        +Uint64 lifespan
        +float speed
        +ShapeConfig shape
    }

    class ShapeConfig {
        <<struct>>
        +float height
        +float width
        +SDL_Color color
    }

    %% ===========================
    %% Relationships
    %% ===========================

    %% Engine owns managers and scenes
    GameEngine "1" *-- "1" ConfigManager : owns
    GameEngine "1" *-- "1" VideoManager : owns
    GameEngine "1" *-- "1" AudioManager : owns
    GameEngine "1" *-- "1" FontManager : owns
    GameEngine "1" *-- "1" TextureManager : owns
    GameEngine "1" *-- "1" AudioSampleQueue : owns
    GameEngine "1" o-- "*" Scene : manages

    %% Scene hierarchy
    Scene <|-- MainScene : inherits
    Scene <|-- MenuScene : inherits
    Scene <|-- ScoreScene : inherits
    Scene <|-- HowToPlayScene : inherits
    Scene --> GameEngine : uses
    Scene --> Action : processes
    Action --> ActionState : has

    %% Scenes use EntityManager
    MainScene "1" *-- "1" EntityManager : owns
    MainScene "1" *-- "1" MainSceneSpawner : owns
    MainSceneSpawner --> EntityManager : spawns entities in
    MainSceneSpawner --> ConfigManager : uses
    MainSceneSpawner --> TextureManager : uses
    
    %% EntityManager manages Entities
    EntityManager "1" o-- "*" Entity : manages
    Entity --> EntityTags : tagged with

    %% Entity contains Components
    Entity "1" *-- "0..1" CTransform : has
    Entity "1" *-- "0..1" CShape : has
    Entity "1" *-- "0..1" CInput : has
    Entity "1" *-- "0..1" CLifespan : has
    Entity "1" *-- "0..1" CEffects : has
    Entity "1" *-- "0..1" CBounceTracker : has
    Entity "1" *-- "0..1" CSprite : has

    %% Components relationships
    CTransform --> Vec2 : uses
    CSprite --> TextureManager : gets texture from
    CEffects --> Effect : contains
    Effect --> EffectTypes : typed by

    %% Managers depend on Config
    VideoManager --> ConfigManager : uses
    ConfigManager --> GameConfig : provides
    ConfigManager --> PlayerConfig : provides
    ConfigManager --> EnemyConfig : provides
    ConfigManager --> BulletConfig : provides
    ConfigManager --> ItemConfig : provides
    ConfigManager --> SpeedEffectConfig : provides
    ConfigManager --> SlownessEffectConfig : provides
    
    %% Config uses ShapeConfig
    PlayerConfig --> ShapeConfig : contains
    EnemyConfig --> ShapeConfig : contains
    BulletConfig --> ShapeConfig : contains
    ItemConfig --> ShapeConfig : contains
    SpeedEffectConfig --> ShapeConfig : contains
    SlownessEffectConfig --> ShapeConfig : contains

    %% AudioManager uses enums
    AudioManager --> AudioTrack : manages
    AudioManager --> AudioSample : manages
    AudioSampleQueue --> AudioSample : queues

    %% Helpers are used by Scenes
    MainScene ..> CollisionHelpers : uses
    MainScene ..> SpawnHelpers : uses
    MainScene ..> EntityHelpers : uses
    MainScene ..> TextHelpers : uses
    MenuScene ..> TextHelpers : uses
    ScoreScene ..> TextHelpers : uses
    HowToPlayScene ..> TextHelpers : uses
    
    %% Helpers use utility classes
    CollisionHelpers ..> Vec2 : uses
    CollisionHelpers ..> Entity : operates on
    SpawnHelpers ..> Vec2 : uses
    SpawnHelpers ..> Entity : creates
    MathHelpers ..> Vec2 : uses
    TextHelpers ..> Vec2 : uses

    %% SDL dependencies (shown implicitly through types)
    note for VideoManager "Uses SDL_Window and SDL_Renderer"
    note for AudioManager "Uses SDL_mixer (Mix_Music, Mix_Chunk)"
    note for CShape "Renders using SDL_Rect and SDL_Color"
    note for CSprite "Wraps SDL_Texture"
